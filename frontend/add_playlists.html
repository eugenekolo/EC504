<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keyword" content="">

    <title>Al Gore Rhythms</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        
    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">    
    <link href="assets/css/style-responsive.css" rel="stylesheet">
    <link href="assets/css/add_playlists.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <section id="container">
      <!-- ****************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      ***************************************************************************************************** -->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <a href="index.html" class="logo"><b>Al Gore Rhythms</b></a>
      </header>
      
      <!-- ****************************************************************************************************
      MAIN SIDEBAR MENU
      ***************************************************************************************************** -->
      <aside>
        <div id="sidebar" class="nav-collapse ">
            <ul class="sidebar-menu" id="nav-accordion">
                <p class="centered"><img src="assets/img/ui-sam.jpg" class="img-circle" width="60"></p>
                <li class="mt">
                    <a href="index.html">
                        <i class="fa fa-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                    <li class="sub-menu">
                        <a href="add_playlists.html">
                            <i class="fa fa-tasks"></i>
                            <span>Add Playlists</span>
                        </a>
                    </li>
                </ul>
            </div>
      </aside>
      
      <!-- ****************************************************************************************************
      MAIN CONTENT
      ***************************************************************************************************** -->
      <section id="main-content">
          <section class="wrapper">
            <h3><i class="fa fa-angle-right"></i> Add Playlists</h3>


              <!-- Left side autocomplete -->
              <div class="col-xs-6 mt">
                <div class="input-group">
                  <input type="text" id="enter-song" class="form-control input-lg" placeholder="Enter Song . . ." >
                </div>  
                </br>
                <div class="content-panel">
                  <table id="autocompleteTable" class="table table-hover autocomplete-table">
                    <thead>
                      <tr>
                        <th>Title</th>
                        <th>Artist</th>
                      </tr>
                    </thead>
                    <tbody>
                        <tr class="song-row">
                            <td>1</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>2</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>3</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>4</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                    </tbody>
                  </table>
                </div>


                <button id="addListBtn" type="button" class="btn btn-primary btn-lg btn-block">Add to list</button>    
                <div class="input-group">
                 <span class="input-group-btn">
                    <button id="uploadListBtn" type="button" class="btn btn-theme btn-lg btn-block">Upload list</button>
                  </span>
                  <input type="text" class="input-lg" id="uploadPopularity", placeholder="Popularity..." />
                </div>
                </br>
                <div class="btn-group">
                  <input id="chooseFileBtn" type="file" class="btn btn-theme input-lg"/>
                  <button id="uploadFileBtn" type="button" class="btn btn-theme btn-lg">Upload file</button>
                </div>

              </div>

              <!-- Right side song list -->
              <div class="col-xs-6 mt">
                <div class="content-panel">
                  <table id="songListTable" class="table table-hover">
                    <hr>
                    <tbody>
                        <tr class="song-row">
                            <td>1</td
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>2</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>3</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                        <tr class="song-row">
                            <td>4</td>
                            <td class="song-title"></td>
                            <td class="song-author"></td>
                        </tr>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>  <!-- END Autocomplete and Song list tables -->



          </section>
      </section>

  </section>


  <!-- js placed at the end of the document so the pages load faster -->
  <script src="assets/js/jquery.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
  <script src="assets/js/jquery.scrollTo.min.js"></script>
  <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>

  <!--common script for all pages-->
  <script src="assets/js/common-scripts.js"></script>
  
  <!--script for this page-->
  <script src="assets/js/jquery-ui-1.9.2.custom.min.js"></script>
  <script src="assets/js/bootstrap-switch.js"></script>
  <script src="assets/js/jquery.tagsinput.js"></script>
  <script type="text/javascript" src="assets/js/bootstrap-inputmask/bootstrap-inputmask.min.js"></script>

  <!-- TODO(eugenek): Move logic out of this file. -->
  <script>

    /*************************************
    * Click handlers
    **************************************/
    /**
    * This onClick submits a file to the backend
    * @note: No validation of the files is done
    * TODO(eugenek): Add validation.
    */
    $("#uploadFileBtn").click(function () {
      var file = $('#chooseFileBtn').prop('files')[0]; // Only one file

      // You got me so high, so high I cannot feel the fire. And you keep telling me that you'll be sweet.
      // As long as I don't break these... promises...
      var data = {}; // 
      var promise = promiseFileContents(file, data);

      $.when(promise).then(function (contents) {
          $.ajax({
              type: 'POST',
              url: '/api/addPlaylists',
              data: JSON.stringify(data),
              dataType: "text",
              contentType: 'application/json',
              processData: false,
              success: function (data) {
                // TODO(eugenek): Add here.
              },
              error: function (data) {
                // TODO(eugenek): Add here.
              }
          });
      });    
    });

    $("#uploadStringBtn").click(function () {
      var data = {};
      data['uploadString'] = $('#playlistInput').val(); // This is a hack to let us use teh same route as uploadFile

      $.ajax({
          type: 'POST',
          url: '/api/addPlaylist',
          data: JSON.stringify(data),
          dataType: "text",
          contentType: 'application/json',
          processData: false,
          success: function (data) {
            // TODO(eugenek): Add here.
          },
          error: function (data) {
            // TODO(eugenek): Add here.
          }
       });  
    });


    $("#addListBtn").click(function () {
      var songRow = songListTable.insertRow(-1); // Add to bottom
      var songTitleCell = songRow.insertCell(0);
      var songAuthorCell = songRow.insertCell(1);
      songTitleCell.innerHTML = "";
      songAuthorCell.innerHTML = "";
    });

    /*************************************
    * Helper functions
    **************************************/
    function promiseFileContents(file, dst) {
      var promise = $.Deferred(function(dfd) {
          var reader = new FileReader();  
          reader.onload = function(event) {  
              var text = event.target.result;
              dst[file.name] = text;
              dfd.resolve(text);
          };
          reader.readAsText(file, "UTF-8");
      }).promise();

      return promise;
    };

  </script>

</body>
</html>
